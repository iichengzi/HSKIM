function f=HSKIM_main(y,lab15,lab5,x_lab15,x_lab5)
%y is the input image; lab15 should set to [1,16];lab5 should set to [1,6];x_lab15
%and x_lab5 are the vectors of classes for layer 1 and 2, such as x_lab15=[1,3,4,8,10,16],x_lab5=[2,4,5,6];
[m,n,np]=size(y);
k_lab15=length(x_lab15); %k_lab15 dividion number at level 1; 
k_lab5=length(x_lab5); %k_lab5 dividion number at level 2;
% initial level lab15 gid15 level
yi_1=lab15;
y1=gray2rgb_gid15(lab15);
[~, labels1]=edison_wrapper(y1,@RGB2Luv);%,'MinimumRegionArea',mr,,'SpatialBandWidth',3,'RangeBandWidth',1'MinimumRegionArea',90mr102
[~,labels0]=edison_wrapper(y,@RGB2Luv,'MinimumRegionArea',500);
labels0=labels0+1;
labels1=labels1+1;
y2=gray2rgb_gid5(lab5);
[~, labels2]=edison_wrapper(y2,@RGB2Luv);%,'MinimumRegionArea',mr,,'SpatialBandWidth',3,'RangeBandWidth',1'MinimumRegionArea',90mr102
labels2=labels2+1;
yi_2=lab5+1;%initial level lab5 gid5 level
rgnCount0 = max(labels0(:));
S0 = regionprops(labels0,'Area' ,'Centroid','PixelIdxList','MajorAxisLength','MinorAxisLength');
tmpStr1  = struct2cell(S0);
cellPiexls0  = tmpStr1(5,:);
labels_1 = three22(labels1);
labels_1 = cellfun(@(cellPiexls0) mode(labels_1(cellPiexls0,:)),cellPiexls0,'UniformOutput',false);
labels_1 = cell2mat(labels_1');
labels_pos=ones(m*n,2); 
labels_index=zeros(m*n,2);
labels_pos(:,1)=labels0(:);
[templ1, index_lab15]=sortrows(labels_pos,1); 
labels_cell=mat2cell(templ1(:,2),accumarray(templ1(:,1),1));
labels_pos1=arrayfun(@(i) labels_cell{i}*labels_1(i),1:rgnCount0,'UniformOutput',false);
labels_pos1=cell2mat(labels_pos1');
labels_index(:,1)=labels_pos1; 
labels_index(:,2)=index_lab15;
labels11=sortrows(labels_index,2);
labels11=reshape(labels11(:,1),[m,n]);
labels_uni=unique(labels11);
rgnCount1 = length(unique(labels11));
for i=1:rgnCount1
    labels11(labels11==labels_uni(i))=i;
end
clear labels_1
S1 = regionprops(labels11,'Area' ,'Centroid','PixelIdxList','MajorAxisLength','MinorAxisLength');
[statt1,~] = labels2edges_revised(labels11); 
tmpStr1  = struct2cell(S1);
cellPiexls1  = tmpStr1(5,:);
yi_1_1 = three22(yi_1);
label_l1_pos = cellfun(@(cellPiexls1) mode(yi_1_1(cellPiexls1,:)),cellPiexls1,'UniformOutput',false);
label_l1_pos = cell2mat(label_l1_pos');
labels_l1_label=ones(m*n,2); 
label_l1_index=zeros(m*n,2); 
labels_l1_label(:,1)=labels11(:);
[templ1, index_lab15]=sortrows(labels_l1_label,1); 
label_1_cell=mat2cell(templ1(:,2),accumarray(templ1(:,1),1));
label_img_pos=arrayfun(@(i) label_1_cell{i}*label_l1_pos(i),1:rgnCount1,'UniformOutput',false);
label_img_pos=cell2mat(label_img_pos');
label_l1_index(:,1)=label_img_pos; 
label_l1_index(:,2)=index_lab15;
label_img=sortrows(label_l1_index,2);
label_l1_img=reshape(label_img(:,1),[m,n]);
rgnCount0 = max(labels0(:));
labels_2 = three22(labels2);
labels_2 = cellfun(@(cellPiexls0) mode(labels_2(cellPiexls0,:)),cellPiexls0,'UniformOutput',false);%对每个区域的初始标记取众数
labels_2 = cell2mat(labels_2');
labels_pos=ones(m*n,2); 
labels_index=zeros(m*n,2); 
labels_pos(:,1)=labels0(:);
[templ1, index_lab15]=sortrows(labels_pos,1); 
labels_cell=mat2cell(templ1(:,2),accumarray(templ1(:,1),1));
labels_pos2=arrayfun(@(i) labels_cell{i}*labels_2(i),1:rgnCount0,'UniformOutput',false);
labels_pos2=cell2mat(labels_pos2');
labels_index(:,1)=labels_pos2; 
labels_index(:,2)=index_lab15;
labels21=sortrows(labels_index,2);
labels21=reshape(labels21(:,1),[m,n]);
labels_uni=unique(labels21);
rgnCount2 = length(unique(labels21));
for i=1:rgnCount2
    labels21(labels21==labels_uni(i))=i;
end
clear labels_2
clear labels_0
S2 = regionprops(labels21,'Area' ,'Centroid','PixelIdxList','MajorAxisLength','MinorAxisLength');
[statt2,~] = labels2edges_revised(labels21);
tmpStr2  = struct2cell(S2);
cellPiexls2  = tmpStr2(5,:);
yi_2_1 = three22(yi_2);
label_l2_pos = cellfun(@(cellPiexls2) mode(yi_2_1(cellPiexls2,:)),cellPiexls2,'UniformOutput',false);
label_l2_pos = cell2mat(label_l2_pos');
labels_l2_label=ones(m*n,2);
label_l2_index=zeros(m*n,2); 
labels_l2_label(:,1)=labels21(:);
[templ2, index_lab5]=sortrows(labels_l2_label,1); 
label_2_cell=mat2cell(templ2(:,2),accumarray(templ2(:,1),1));
label_img_pos=arrayfun(@(i) label_2_cell{i}*label_l2_pos(i),1:rgnCount2,'UniformOutput',false);
label_img_pos=cell2mat(label_img_pos');
label_l2_index(:,1)=label_img_pos;
label_l2_index(:,2)=index_lab5;
label_img=sortrows(label_l2_index,2);
label_l2_img=reshape(label_img(:,1),[m,n]);
yy=three22(y);
s1=ones(16,16);
s1(1:max(label_l1_img(:)),1:max(label_l1_img(:)))=labels2edges_revised(label_l1_img);
l1=zeros(16,16);
for i=1:k_lab5
    label_lij=zeros(size(label_l1_img));
    label_lij(label_l2_img==x_lab5(i))=label_l1_img(label_l2_img==x_lab5(i));
    label_lij=label_lij+1;
    temp_lij=labels2edges_revised(label_lij);
    temp_lij=temp_lij./(sum(temp_lij,2)+1);
    [a1,b1]=size(temp_lij);
    temp_l1=zeros(16,16);
    temp_l1(1:a1-1,1:b1-1)=temp_lij(2:a1,2:b1);
    l1=l1+temp_l1;
end   
l1=exp(l1);
s1=l1.*s1; 
s1(s1==-Inf)=0;
s2=zeros(6,6);
s2(1:max(label_l2_img(:)),1:max(label_l2_img(:)))=labels2edges_revised(label_l2_img);
s2=log(s2+1);
label_l1_pri=zeros(rgnCount1,1); 
label_l2_pri=zeros(rgnCount2,1); 
label_inter=zeros(6,16);
label_inter(1,:)=1;label_inter(:,1)=1;
label_inter(2,14)=1;label_inter(2,15)=1;label_inter(2,16)=1;
label_inter(3,2)=1;label_inter(3,3)=1;label_inter(3,4)=1;label_inter(3,5)=1;
label_inter(4,6)=1;label_inter(4,7)=1;label_inter(4,8)=1;%label_inter(3,5)=1;
label_inter(5,9)=1;label_inter(5,10)=1;label_inter(5,11)=1;
label_inter(6,12)=1;label_inter(6,13)=1;%label_inter(5,11)=1;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       1;label_inter(5,10)=1;label_inter(5,11)=1;
label_inter=label_inter';
ite=0;
alp1=log((m*n)/rgnCount2);alp2=log((m*n)/rgnCount1);
while sum(abs(label_l1_pos-label_l1_pri))>0 && sum(abs(label_l2_pos-label_l2_pri))>0 && ite<5 %
    ite=ite+1;
    label_l1_pri=label_l1_pos;
    label_l2_pri=label_l2_pos;
    label_l2_img_p=label_l2_img;
    label_l1_img_p=label_l1_img;
    mu_1 = zeros(k_lab15, np);
    sigma_1 = zeros(np,np,k_lab15);
    E_ob_object_1=zeros(m*n,k_lab15); 
    label_indicate_1_2=zeros(rgnCount1,k_lab15);
    for i = 1:k_lab15
        Im_i_1 = yy(label_l1_img_p == x_lab15(i),:);
        [I1, ~]=size(Im_i_1);
        if I1>0
            [sigma_1(:,:,i),mu_1(i,:)] = covmatrix(Im_i_1);
            mu_i_1 = mu_1(i,:);
            sigma_i_1 = sigma_1(:,:,i);
            diff_i_1 = yy - repmat(mu_i_1,[n*m,1]);
            E_ob_object_1(:,i) = sum(diff_i_1 /(sigma_i_1) .* diff_i_1, 2) + log(det(sigma_i_1));
        else
            E_ob_object_1(:,i)=1/eps;
        end
        label_indicate_1_2(:,i)=(label_l1_pri~=x_lab15(i));
    end
    label_interactive=zeros(k_lab15,k_lab5);
    inter=zeros(k_lab15,k_lab5);
    t=ones(m*n,1);
    for i=1:k_lab15
        for j=1:k_lab5
            label_interactive(i,j)=sum(t(label_l1_img==x_lab15(i) & label_l2_img==x_lab5(j)));
            inter(i,j)=label_inter(x_lab15(i),x_lab5(j));
        end
    end
    label_inter_1=(label_interactive./(ones(k_lab15,1)*sum(label_interactive,1)+1))';
    inter1=inter';
    label_inter_11=label_inter_1.*inter1;
    label_inter_11(label_inter_11==0)=(label_inter_1(label_inter_11==0)).^ite;
    label_inter_11=-log(label_inter_11+0.001);
    E_ob_1 = cellfun(@(cellPiexls1) sum(E_ob_object_1(cellPiexls1,:)),cellPiexls1,'UniformOutput',false);
    E_ob_1 = cell2mat(E_ob_1');
    num_ij_1=zeros(rgnCount1,k_lab5); 
    label_l2=three22(label_l2_img);
    label_l2_l1 = cellfun(@(cellPiexls1) label_l2(cellPiexls1,:),cellPiexls1,'UniformOutput',false);
    label_inter_for_1=zeros(rgnCount1,k_lab15);
    for j=1:k_lab5
        temp1=arrayfun(@(i) sum((label_l2_l1{i}==x_lab5(j))),1:rgnCount1,'UniformOutput',false);
        num_ij_1(:,j)=cell2mat(temp1');
        label_inter_for_1=arrayfun(@(i) label_inter_for_1(i,:)+num_ij_1(i,j)*label_inter_11(j,:),1:rgnCount1,'UniformOutput',false);
        label_inter_for_1=cell2mat(label_inter_for_1'); 
    end
     L_i_t_j_1=zeros(rgnCount1,1);
     E_labels_1=zeros(rgnCount1,k_lab15);
     for i=1:rgnCount1
        for t1=1:k_lab15
             for j=1:rgnCount1 
                  L_i_t_j_1(j,:)=s1(label_l1_pos(j),x_lab15(t1));
             end
              E_labels_1(i,t1)=statt1(i,:)*L_i_t_j_1;
        end
     end
     E_labels_1=label_indicate_1_2.*E_labels_1;
     E_l1_l2=alp1*label_inter_for_1;
     E_total_1=E_ob_1+E_labels_1+E_l1_l2;
     [~, temp_a]=min(E_total_1,[],2);
    label_l1_pos=arrayfun(@(i) x_lab15(temp_a(i)),1:rgnCount1,'UniformOutput',false);
    label_l1_pos=cell2mat(label_l1_pos');
    label_img_pos=arrayfun(@(i) label_1_cell{i}*label_l1_pos(i),1:rgnCount1,'UniformOutput',false);
    label_img_pos=cell2mat(label_img_pos');
    label_l1_index(:,1)=label_img_pos; 
    label_img=sortrows(label_l1_index,2);
    label_l1_img=reshape(label_img(:,1),[m,n]);  
    label_l1=three22(label_l1_img);
    label_l1_l2 = cellfun(@(cellPiexls2) label_l1(cellPiexls2,:),cellPiexls2,'UniformOutput',false);%对每个区域的初始标记取众数
    mu_2 = zeros(k_lab5, np);
    sigma_2 = zeros(np,np,k_lab5);
    E_ob_object_2=zeros(m*n,k_lab5);
    label_indicate_2=zeros(rgnCount2,k_lab5); 
    for i = 1:k_lab5
        Im_i_2 = yy(label_l2_img_p == x_lab5(i),:);
        [I1,~]=size(Im_i_2);
        if I1>0
            [sigma_2(:,:,i),mu_2(i,:)] = covmatrix(Im_i_2);
            mu_i_2 = mu_2(i,:);
            sigma_i_2 = sigma_2(:,:,i);
            diff_i_2 = yy - repmat(mu_i_2,[n*m,1]);
            E_ob_object_2(:,i) = sum(diff_i_2 /(sigma_i_2).* diff_i_2, 2) + log(det(sigma_i_2));
        else
            E_ob_object_2(:,i)=1/eps;
        end
        label_indicate_2(:,i)=(label_l2_pri~=x_lab5(i));
    end
    label_inter_2=(label_interactive./(sum(label_interactive,2)*ones(1,k_lab5)+1));
    label_inter_21=label_inter_2.*inter;
    label_inter_21(label_inter_21==0)=(label_inter_2(label_inter_21==0)).^ite;
    label_inter_21=-log(label_inter_21+0.001);
    num_ij_2=zeros(rgnCount2,k_lab15);
    label_inter_for_2=zeros(rgnCount2,k_lab5);
    for j=1:k_lab5
        temp2=arrayfun(@(i) sum(label_l1_l2{i}==x_lab15(j)),1:rgnCount2,'UniformOutput',false);
        num_ij_2(:,j)=cell2mat(temp2');
        label_inter_for_2=arrayfun(@(i) label_inter_for_2(i,:)+num_ij_2(i,j)*label_inter_21(j,:),1:rgnCount2,'UniformOutput',false);
        label_inter_for_2=cell2mat(label_inter_for_2'); 
    end
    E_ob_2 = cellfun(@(cellPiexls2) sum(E_ob_object_2(cellPiexls2,:)),cellPiexls2,'UniformOutput',false);
    E_ob_2 = cell2mat(E_ob_2');
    E_labels_2=zeros(rgnCount2,k_lab5);
    label_indicate_2(label_indicate_2==0)=-1;
    L_i_t_j_2=zeros(rgnCount2,1);
    for i=1:rgnCount2
        for t2=1:k_lab5
             for j=1:rgnCount2 
                  L_i_t_j_2(j,:)=s2(label_l2_pos(j),x_lab5(t2));
             end
              E_labels_2(i,t2)=statt2(i,:)*L_i_t_j_2;
        end
     end
    E_labels_2=E_labels_2.*label_indicate_2;
    E_l2_l1=alp2*label_inter_for_2;
    E_total_2=E_ob_2+E_labels_2+E_l2_l1;
    [~, temp_a]=min(E_total_2,[],2);
    label_l2_pos=arrayfun(@(i) x_lab5(temp_a(i)),1:rgnCount2,'UniformOutput',false);
    label_l2_pos=cell2mat(label_l2_pos');
    label_img_pos=arrayfun(@(i) label_2_cell{i}*label_l2_pos(i),1:rgnCount2,'UniformOutput',false);
    label_img_pos=cell2mat(label_img_pos');
    label_l2_index(:,1)=label_img_pos; 
    label_img=sortrows(label_l2_index,2);
    label_l2_img=reshape(label_img(:,1),[m,n]);
end                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
label_l1_img=label_l1_img-1;
yi_1=yi_1-1;
label_l1_img(label_l1_img==0)=yi_1(label_l1_img==0);
label_l1_img(yi_1==0)=0;
label_l2_img=label_l2_img-1;
label_l2_img(label_l2_img==0)=lab5(label_l2_img==0);
label_l2_img(lab5==0)=0;
f=cat(3,label_l1_img,label_l2_img,yi_1,lab5);